<section class="bg--grey">
  <div class="layout-wrapper">
    <h1>
      <%= t(:title, scope: 'profiles.index') %>
    </h1>
    <p>
      <%= t(:text, scope: 'profiles.index').html_safe %>
    </p>

    <%= render partial: 'shared/profile_search' %>

    <div class="layout mb+">
      <%# if in search: %>
      <% if params[:search] %>
        <% if @profiles.any? %>
          <p class="text--color-blue font-size-24 text--center layout__item 1/1">
            <%= t(:success, scope: 'search' ).html_safe +
                t(:result, scope: 'search', count: @profiles.total_count).html_safe %><br>
            <%= t(:profiles, link: link_to(t(:all_profiles, scope: 'search'), profiles_path), scope: 'search').html_safe %>
          </p>

          <p>Found profiles: <small><%= @profiles.response.response.hits.total %></small></p>

        <div class="layout-wrapper">
          <div class="layout__item 1/2 palm-1/1">

          <ul id="facets">Cities:
            <% @aggs_cities.each do |term| %>
            <li><a href="/?t=<%= term['key'] %>"><%= term['key'] %></a> <small class="c"><%= term['doc_count'] %></small></li>
            <% end %>
          </ul>
          </div><!--
          -->
          <div class="layout__item 2/2 palm-1/1">
            <ul id="facets">Languages:
            <% @aggs_languages.each do |term| %>
            <li><a href="/?t=<%= term['key'] %>"><%= term['key'] %></a> <small class="c"><%= term['doc_count'] %></small></li>
            <% end %>
          </ul>
          </div>
          </div>

          <%= render partial: 'profiles/profile_search', collection: @profiles, as: :profile %>

        <% else %>
          <p class="text--color-blue font-size-24 text--center layout__item 1/1">
            <%= t(:no_profile, link: link_to(t(:all_profiles, scope: 'search'), profiles_path), scope: 'search').html_safe %>
          </p>
        <% end %>

      <%# if in topic or category or nothing: %>
      <% else %>

        <% if params[:topic] %>
          <p class="text--color-blue font-size-24 text--center layout__item 1/1">
            <%= t(:profiles_topics, scope: 'search', profiles_count: @profiles.total_count, topics_name: params[:topic]).html_safe %>
          </p>

        <% elsif params[:category_id] %>
          <p class="text--color-blue font-size-24 text--center layout__item 1/1">
            <%= t(:category, scope: 'profiles', category_name: @category.name, profiles_count: @profiles.total_count, topics_count: @tags.size).html_safe %>
          </p>
        <% else %>
          <p class="text--color-blue font-size-24 text--center layout__item 1/1">
            <%= t(:all_speakerinnen, scope: 'profiles.index', profiles_count: @profiles.total_count).html_safe %>
          </p>

        <% end %>

      <%= paginate @profiles %>

        <% if @profiles.any? %>
          <% if @profiles.size == 1 %>
            <%= render partial: 'profiles/profile', object: @profiles[0], locals: { just_one: true } %>
          <% else %>
            <%= render partial: 'profiles/profile', object: @profiles[0], locals: { is_first: true } %>
            <%= render partial: 'profiles/profile', collection: @profiles[1..-2] %>
            <%= render partial: 'profiles/profile', object: @profiles[-1], locals: { is_last: true } %>
          <% end %>
        <% end %>

      <% end %>
    </div>

    <a id="topics_anchor"></a>

    <%= paginate @profiles %>

    <%= render partial: 'tag' %>

    <%= render partial: 'layouts/footer' %>

  </div>
</section>
